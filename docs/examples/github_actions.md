This is an example of how to integrate Komposer in Github Actions.

The configuration is divided in three blocks:

- building and pushing the Docker image
- cleaning Komposer's Kubernetes resources previously deployed
- deploy the new Kubernetes resource generated from Komposer

The example includes also some preliminary steps to setup Pytohn and Google Cloud SDK, they are there for completness but not mandatory to deploy the resources generated by Komposer.

```yaml
--8<-- "examples/github_actions.yml"
```

!!! note

    The branch name is a lowercase kebab <!-- fixme: link to kebab --> version of the Git's branch name with any slash converted into dashes; this makes the branch name compatible with Kubernetes naming rules <!-- fixme: link to naming rules in k8s -->.

## Building and pushing the image

The first step is to build and push the docker image of your service into the Docker hub:

```yaml hl_lines="15-25"
--8<-- "examples/github_actions.yml"
```

## Cleaning Kubernetes resources

Before deploying we need to remove any previously deployed resources by deleting all the resources with the labels matching the branch and repository names:

```yaml hl_lines="27-58"
--8<-- "examples/github_actions.yml"
```

This is necessary because resources can be added, removed or renamed in the Komposer manifest between runs of the CI and the `kubectl` command doesn't provide a way to perform a full sync of the resources in the cluster compared with the resources in the Komposer's manifest.

## Deploy the Komposer manifest

The last section, generating the Kubernetes manifest with Komposer and deploying the resources in the Kubernetes cluster.

After installing Python and setting up Google Cloud SDK we generate the manifest's template with Komposer:

```yaml hl_lines="96-106"
--8<-- "examples/github_actions.yml"
```

Then we render the manifest by substituting the variables, in this case the Docker image's name, deploy it and waiting for the rollout to finish:

```yaml hl_lines="107-124"
--8<-- "examples/github_actions.yml"
```
